<template>
	<div class="bg-slate-900 rounded-2xl p-4 relative mt-3"
		v-for="scheda of schedeStore.storiaFilled"
		:key="scheda?.nome"
		@click.self="goToScheda"
	>
		<ion-img src="assets/GIFs/4774.gif" class="overflow-hidden w-20 h-20 rounded-2xl"></ion-img>
		<div class="absolute left-28 top-4">
			<p class="text-lg">{{ scheda?.nome }}</p>
			<p class="text-sm text-slate-600">Durata: {{ hTempo(scheda) }}</p>
			<p class="text-sm text-slate-600">Intensit√†: {{ scheda?.intensita }} su 3</p>
		</div>
		<div class="absolute right-0" style="top: calc(50% - calc(1.25rem /2))">
			<div class="h-6">
				<ion-icon class="h-full mr-3" size="large" :icon="icon" @click="toggleFav"></ion-icon>
			</div>
		</div>
	</div>


	
</template>

<script lang="ts" setup>
import { star, starOutline } from 'ionicons/icons';
import { IonImg, useIonRouter, IonIcon } from '@ionic/vue';
import { useSchedeStore } from '@/stores/schede'
import { computed, ref } from 'vue';
import type { Scheda } from '@/models/Schede';
import { defineProps } from 'vue';


const router = useIonRouter()
const props = defineProps(['scheda'])
const scheda = ref(props.scheda)
const routeTo = `/scheda/${scheda?.value.id}`
const schedeStore = ref(useSchedeStore())

const icon = computed(() => {
	return scheda.value.isFavourite ? star : starOutline
})

const toggleFav = () => {
	schedeStore.value.toggleFavScheda(scheda)
	scheda.value.isFavourite = !scheda.value.isFavourite
}


function hTempo(scheda?: Scheda){
	if(!scheda) return ''
	const ore = Math.floor(+scheda.durata / 60)
	return `${ore}h e ${+scheda.durata-(ore*60)}min`
}

function goToScheda(){
	router.navigate(`/scheda/${scheda?.value.id}`, 'forward', `push`)
}

</script>